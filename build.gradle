import org.apache.tools.ant.filters.ReplaceTokens;

plugins {
	id 'java'
	id 'com.github.johnrengelman.shadow' version '5.0.0'
	id 'org.spongepowered.plugin' version '0.9.0'
	id 'eclipse'
	id 'idea'
}


version = '4.0.0'

def buildNumber = System.getenv("GITHUB_RUN_NUMBER")

if(buildNumber != null) {
	version += "-b" + buildNumber
}

// In this section you declare where to find the dependencies of your project
repositories {
	maven { url "https://hub.spigotmc.org/nexus/content/repositories/snapshots"}
	maven { url = 'https://repo.spongepowered.org/maven' }
    maven { url = "https://oss.sonatype.org/content/repositories/snapshots" }
    mavenCentral()
	maven { url 'https://jitpack.io' }
}


sponge {
    plugin {
        id = 'dynamicgui'
        meta {
			name = 'DynamicGui'
		}
    }
}

processResources {
	from(sourceSets.main.resources) {
		include 'plugin.yml'
		filter(ReplaceTokens, tokens: ['VERSION' : project.version])
	}
}

shadowJar {
	relocate 'org.spongepowered.configurate', 'com.clubobsidian.dynamicgui.shaded.configurate'
	relocate 'com.google.common', 'com.clubobsidian.dynamicgui.shaded.guava'
	relocate 'com.google.gson', 'com.clubobsidian.dynamicgui.shaded.gson'
	relocate 'org.yaml.snakeyaml', 'com.clubobsidian.dynamicgui.shaded.snakeyaml'
	relocate 'com.clubobsidian.trident', 'com.clubobsidian.dynamicgui.shaded.trident'
	relocate 'com.clubobsidian.wrappy', 'com.clubobsidian.dynamicgui.shaded.wrappy'
	relocate 'net.kyori', 'com.clubobsidian.dynamicgui.shaded.kyori'
	relocate 'com.clubobsidian.fuzzutil', 'com.clubobsidian.dynamicgui.shaded.fuzzutil'
	baseName = 'DynamicGui'
	classifier = ''
}

dependencies {
    testImplementation 'junit:junit:4.12'
    
    //Server implementations
    
    compileOnly 'org.spigotmc:spigot-api:1.8.8-R0.1-SNAPSHOT'
    compileOnly 'net.md-5:bungeecord-api:1.8-SNAPSHOT'
    compileOnly('org.spongepowered:spongevanilla:1.12.2-7.1.5'){
    	exclude group: 'org.spongepowered', module: 'testmods'
    }

	//Plugins
	compileOnly 'com.github.clubobsidian:foundry:2.0.0'

	//Dependencies
    compile 'org.apache.commons:commons-lang3:3.9'
    compile 'commons-io:commons-io:2.6'
    compile 'com.github.clubobsidian:wrappy:2.1.0'
    compile 'com.github.clubobsidian:trident:2.1.0'
    compile 'com.github.clubobsidian:dynamicguiparser:2.10.0'
    compile 'com.udojava:EvalEx:2.1'
    compile 'com.github.ClubObsidian:FuzzUtil:1.1.0'
    compile 'com.google.inject:guice:4.2.3'
    compile 'net.kyori:adventure-text-minimessage:4.1.0-SNAPSHOT'
    compile 'net.kyori:adventure-text-serializer-gson:4.3.0'
}